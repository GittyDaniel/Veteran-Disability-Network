<section class="referral-section">
    <header class="hero-header">
        <div class="hero-content">
            <h1>Veteran Referral Program</h1>
            <p>If the support you received from Veterans Disability Network made a difference, help us reach more of your brothers and sisters in arms. Share the word – the assistance they deserve is just a referral away.</p>
        </div>
    </header>

    <main class="main-content">
        <section id="registration-view" class="registration-section">
            <h2>Get Your Unique Referral Code</h2>
            <p class="subtitle">Enter your email below. We'll send you a secure link to access your referral dashboard.</p>
            <form id="magic-link-form" class="email-form">
                <div class="form-group">
                    <label for="email">Email Address</label>
                    <input type="email" id="email" name="email" placeholder="you@example.com" required>
                </div>
                <button type="submit" class="submit-btn">
                    <span class="btn-text">Send Magic Link</span>
                    <div class="spinner" hidden></div>
                </button>
                <div id="form-message" class="form-message"></div>
            </form>
        </section>

        <section id="referral-code-view" class="registration-section" hidden>
            <h2>Your Referral Dashboard</h2>
            <p class="subtitle">Welcome, <strong id="user-email"></strong>! Share the code below.</p>
            <div class="referral-box">
                <h3>Your Unique Referral Code:</h3>
                <div id="referral-code" class="referral-code" title="Click to copy"></div>
                <p id="copy-feedback" class="copy-feedback"></p>
            </div>
            <button id="sign-out-btn" class="submit-btn">Sign Out</button>
        </section>

        <section class="how-it-works">
            <h2>Choose Your Reward: A $300 Cash Bonus or a $300 Discount For a Friend</h2>
            <p class="description">For every fellow Veteran you refer who becomes a new client, you can choose your reward. Take a $300 cash bonus as our thank you, or 'pay it forward' by giving them a $300 discount on our services. There’s no limit to how many you can refer.</p>
            <div class="steps-container">
                <div class="step-item">
                    <div class="step-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M6 4H20V20H6V16H4V20C4 21.1046 4.81403 22 5.81818 22H20C21.1046 22 22 21.1046 22 20V4C22 2.89543 21.1046 2 20 2H5.81818C4.81403 2 4 2.89543 4 4V8H6V4Z" fill="black"/>
                            <path d="M2 13H12.5858L9.29289 16.2929L10.7071 17.7071L16.4142 12L10.7071 6.29289L9.29289 7.70711L12.5858 11H2V13Z" fill="black"/>
                        </svg>
                    </div>
                    <div class="step-content">
                        <h3>1. Register and Get Your Link</h3>
                        <p>Enroll in the Veterans Disability Network Referral Program using the buttons above. You get emailed with a secure link to access your referral dashboard.</p>
                    </div>
                </div>
                <div class="step-item">
                    <div class="step-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd" clip-rule="evenodd" d="M22 6C22 3.79086 20.2091 2 18 2C15.7909 2 14 3.79086 14 6C14 6.28736 14.0303 6.56764 14.0879 6.83782L9.01708 9.37366C8.28377 8.53195 7.20401 8 6 8C3.79086 8 2 9.79086 2 12C2 14.2091 3.79086 16 6 16C7.20401 16 8.28377 15.468 9.01708 14.6263L14.0879 17.1622C14.0303 17.4324 14 17.7126 14 18C14 20.2091 15.7909 22 18 22C20.2091 22 22 20.2091 22 18C22 15.7909 20.2091 14 18 14C16.796 14 15.7162 14.532 14.9829 15.3737L9.91212 12.8378C9.9697 12.5676 10 12.2874 10 12C10 11.7126 9.9697 11.4324 9.91212 11.1622L14.9829 8.62634C15.7162 9.46805 16.796 10 18 10C20.2091 10 22 8.20914 22 6ZM16 18C16 16.8954 16.8954 16 18 16C19.1046 16 20 16.8954 20 18C20 19.1046 19.1046 20 18 20C16.8954 20 16 19.1046 16 18ZM6 10C4.89543 10 4 10.8954 4 12C4 13.1046 4.89543 14 6 14C7.10457 14 8 13.1046 8 12C8 10.8954 7.10457 10 6 10ZM16 6C16 4.89543 16.8954 4 18 4C19.1046 4 20 4.89543 20 6C20 7.10457 19.1046 8 18 8C16.8954 8 16 7.10457 16 6Z" fill="black"/>
                        </svg>
                    </div>
                    <div class="step-content">
                        <h3>2. Spread the Word</h3>
                        <p>Share your link however you'd like—on social media, via email, text message, or just by telling a friend. Every time a Veteran signs up for a qualifying service through your link, we'll credit your account with your chosen reward.</p>
                    </div>
                </div>
            </div>
        </section>
    </main>
</section>

<style>
    /* All your existing CSS */
    .referral-section {
        --color-navy: #1a233f; --color-dark-navy: #111827; --color-white: #ffffff;
        --color-off-white: #f3f4f6; --color-text-light: #d1d5db; --color-text-dark: #374151;
        --color-accent-red: #b91c1c; --color-border: #e5e7eb;
    }
    .hero-header {
        color: var(--color-white); text-align: center; padding: 5rem 1.5rem;
        position: relative; background-color: var(--color-navy);
        background-image: url('https://placehold.co/1200x400/1a233f/1a233f');
        background-size: cover; background-position: center;
    }
    .hero-header::before {
        content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
        background: rgba(26, 35, 63, 0.7); z-index: 1;
    }
    .hero-content { position: relative; z-index: 2; }
    .hero-header h1 {
        font-family: 'Merriweather', serif; font-size: 3rem; font-weight: 900;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
    }
    .hero-header p {
        font-size: 1.25rem; color: var(--color-text-light); max-width: 60ch; margin: 1rem auto 0;
    }
    .main-content { padding: 3rem 1.5rem; max-width: 1000px; margin: 0 auto; }
    .registration-section {
        background-color: var(--color-white); padding: 2.5rem; border-radius: 8px;
        text-align: center; box-shadow: 0 4px 15px rgba(0,0,0,0.08); margin-bottom: 3rem;
    }
    .registration-section h2 {
        font-family: 'Merriweather', serif; font-size: 2rem; color: var(--color-dark-navy);
        margin-bottom: 0.5rem;
    }
    .subtitle {
        font-size: 1.1rem; color: var(--color-text-dark); max-width: 55ch; margin: 0 auto 2rem auto;
    }
    .email-form {
        display: flex; flex-direction: column; gap: 1.25rem; max-width: 380px; margin: 0 auto;
    }
    .form-group { text-align: left; }
    .form-group label {
        display: block; font-weight: 600; margin-bottom: 0.5rem; color: var(--color-text-dark);
    }
    .form-group input {
        width: 100%; padding: 0.75rem 1rem; font-size: 1rem; border: 1px solid var(--color-border);
        border-radius: 6px; background-color: var(--color-off-white);
    }
    .submit-btn {
        display: flex; /* ADDED for spinner alignment */
        align-items: center; /* ADDED */
        justify-content: center; /* ADDED */
        min-height: 48px; /* ADDED to prevent size change */
        padding: 0.8rem 1.5rem; font-size: 1.1rem; font-weight: 700; background: var(--color-navy);
        color: var(--color-white); border: none; border-radius: 6px; cursor: pointer;
        transition: background-color 0.3s ease;
    }
    .submit-btn:hover { background-color: var(--color-dark-navy); }
    .form-message {
        margin-top: 1rem; padding: 0.75rem; border-radius: 6px; font-weight: 500;
        display: none;
    }
    .form-message--success { background-color: #d1fae5; color: #065f46; }
    .form-message--error { background-color: #fee2e2; color: #991b1b; }
    #referral-code-view { padding: 2rem; }
    .referral-box {
        background-color: var(--color-white); border: 2px dashed var(--color-border);
        border-radius: 8px; padding: 2rem; text-align: center;
    }
    .referral-box h3 { font-size: 1.25rem; color: var(--color-text-dark); margin: 0 0 1rem; }
    .referral-code {
        font-size: 2.5rem; font-weight: bold; color: var(--color-navy);
        background-color: var(--color-off-white); padding: 1rem; border-radius: 6px;
        letter-spacing: 2px; margin-bottom: 1.5rem; cursor: pointer;
    }
    .copy-feedback { font-weight: 500; color: #166534; }
    #sign-out-btn { margin-top: 2rem; background-color: var(--color-accent-red); }
    .how-it-works { text-align: center; }
    .how-it-works h2 {
        font-family: 'Merriweather', serif; font-size: 2.25rem;
        color: var(--color-navy); margin-bottom: 0.75rem;
    }
    .how-it-works .description {
        font-size: 1.1rem; max-width: 70ch; margin: 0 auto 3rem auto;
    }
    .steps-container {
        display: grid; grid-template-columns: 1fr 1fr; gap: 2.5rem; text-align: left;
    }
    .step-item {
        background-color: var(--color-white); padding: 2rem; border-radius: 8px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.05); display: flex;
        gap: 1.5rem; align-items: flex-start;
    }
    .step-icon {
        flex-shrink: 0; width: 50px; height: 50px; display: flex;
        align-items: center; justify-content: center;
        background-color: #e8eaf6; color: var(--color-primary);
        border-radius: 50%;
    }
    .step-icon svg { width: 24px; height: 24px; }
    .step-item h3 {
        font-size: 1.5rem; margin-bottom: 0.5rem; color: var(--color-dark-navy);
    }

    /* NEW: Spinner Styles */
    .spinner {
        width: 20px;
        height: 20px;
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-top-color: #fff;
        border-radius: 50%;
        animation: spin 1s linear infinite;
    }
    @keyframes spin {
        to { transform: rotate(360deg); }
    }
    .submit-btn.loading .btn-text {
        display: none; /* Hide text when loading */
    }
    .submit-btn.loading .spinner {
        display: block; /* Show spinner when loading */
    }

    @media (max-width: 768px) {
        .hero-header h1 { font-size: 2.25rem; }
        .hero-header p { font-size: 1.1rem; }
        .steps-container { grid-template-columns: 1fr; }
    }
</style>

<script src="../scripts/referral.ts"></script>